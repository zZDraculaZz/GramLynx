# Микросервис «Text → Clean Text» (каркас)

Безопасный сервис очистки текста с жёсткими ограничениями. Репозиторий представляет собой **каркас** и следует описанной архитектуре, работает локально без внешних ML-моделей.

## Быстрый старт

```bash
pip install -e .
uvicorn app.main:app --reload
```

## API

### POST `/clean`
Запрос:
```json
{
  "text": "Пример текста...",
  "mode": "strict"
}
```

Ответ:
```json
{
  "clean_text": "Пример текста..."
}
```

## Режимы
- **strict**: минимальные изменения, высокие пороги уверенности, агрессивный откат.
- **smart**: допускает чуть больше безопасного форматирования при сохранении смысла.

## Тестирование

```bash
pytest -q
```

## Плагинная система стадий

Стадии собираются через реестр `stage_name -> StageClass`. Фабрика `build_pipeline` формирует пайплайн на основе `PolicyConfig.enabled_stages`.

Пример кастомной стадии находится в `app/core/stages/custom_example.py` и выключен по умолчанию. Чтобы включить:

1. Добавьте `"custom_example"` в `enabled_stages` нужной политики.
2. Убедитесь, что стадия не меняет Protected Zones (иначе guardrails откатят изменения).

## Примечания
- Внешние ML-модели не требуются: используется rule-based заглушка.
- Protected Zones маскируются до правок и восстанавливаются в конце.
- Сырые пользовательские тексты по умолчанию не логируются.
